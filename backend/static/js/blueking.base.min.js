BLUEKING.base = (function () { return { init: function () { $('body').on('contextmenu', function () { return false }); BLUEKING.deskTop.init(); BLUEKING.wallpaper.init(); BLUEKING.searchbar.init(); BLUEKING.docktool.init(); BLUEKING.taskbar.init(); BLUEKING.dock.init(); BLUEKING.app.init(); BLUEKING.window.init(); BLUEKING.folderView.init(); BLUEKING.appmanage.init(); BLUEKING.popupMenu.init(); BLUEKING.hotkey.init(); BLUEKING.version.init(); BLUEKING.license.init(); BLUEKING.base.getSkin(function (skin) { BLUEKING.base.setSkin(skin) }) }, logout_handler: function () { var logout_url = BLUEKING.corefunc.get_logout_urlprefix(); window.location.href = logout_url }, logout: function () { var dialog = art.dialog({ title: gettext('注销确认'), content: gettext('注销蓝鲸后需要重新登录，您确认注销?'), fixed: true, id: 'logout', icon: 'question', okVal: gettext('确定'), cancelVal: gettext('取消'), ok: function () { BLUEKING.base.logout_handler() }, cancel: true }) }, setLanguage: function (language, callback) { $.ajax({ type: 'POST', data: { language: language }, async: false, url: urlPrefix + 'i18n/set_language/', success: function () { callback && callback() } }) }, getSkin: function (callback) { $.ajax({ type: 'POST', url: urlPrefix + 'get_skin/', success: function (skin) { callback && callback(skin) } }) }, setSkin: function (skin, callback) { function styleOnload(node, callback) { if (node.attachEvent) { node.attachEvent('onload', callback) } else { setTimeout(function () { poll(node, callback) }, 0) } } function poll(node, callback) { if (callback.isCalled) { return } var isLoaded = false; if (/webkit/i.test(navigator.userAgent)) { if (node['sheet']) { isLoaded = true } } else if (node['sheet']) { try { if (node['sheet'].cssRules) { isLoaded = true } } catch (ex) { if (ex.code === 1000) { isLoaded = true } } } if (isLoaded) { setTimeout(function () { callback() }, 1) } else { setTimeout(function () { poll(node, callback) }, 1) } } $('#window-skin').attr('id', 'window-skin-ready2remove'); var css = document.createElement('link'); css.rel = 'stylesheet'; css.href = staticUrl + 'css/skins/' + skin + '.min.css?' + staticVersion; css.id = 'window-skin'; document.getElementsByTagName('head')[0].appendChild(css); styleOnload(css, function () { $('#window-skin-ready2remove').remove(); BLUEKING.CONFIG.skin = skin; callback && callback() }) }, help: function () { if (!$.browser.msie || ($.browser.msie && $.browser.version > 8)) { $('body').append(helpTemp); var w = $(window).width(); var h = $(window).height(); if (BLUEKING.CONFIG.dockPos == 'left') { var top = (h - 600) / 2 + 100; $('#step3').css({ 'top': top, 'left': 105 }); $('#step4').css({ 'top': top + 370, 'left': 105 }); $('#step3 b').remove(); $('#step3').prepend('<b class="jt jt_left" style="left:-40px;top:45px"></b>'); $('#step4 b').remove(); $('#step4').prepend('<b class="jt jt_left" style="left:-40px;top:45px"></b>') } else if (BLUEKING.CONFIG.dockPos == 'top') { var left = (w - 600) / 2 + 50; $('#step3').css({ 'top': 105, 'left': left }); $('#step4').css({ 'top': 105, 'left': left + 370 }); $('#step3 b').remove(); $('#step3').prepend('<b class="jt jt_top" style="left:122px;top:-40px"></b>'); $('#step4 b').remove(); $('#step4').prepend('<b class="jt jt_top" style="left:122px;top:-40px"></b>') } else if (BLUEKING.CONFIG.dockPos == 'right') { var top = (h - 600) / 2 + 100; var left = (w - 400); $('#step3').css({ 'top': top, 'left': left }); $('#step4').css({ 'top': top + 370, 'left': left }); $('#step3 b').remove(); $('#step3').prepend('<b class="jt jt_right" style="left:290px;top:45px"></b>'); $('#step4 b').remove(); $('#step4').prepend('<b class="jt jt_right" style="left:290px;top:45px"></b>') } $('#step1').show(); $('.close').on('click', function () { $('#help').remove() }); $('.next').on('click', function () { var obj = $(this).parents('.step'); var step = obj.attr('step'); obj.hide(); $('#step' + (parseInt(step) + 1)).show() }); $('.over').on('click', function () { $('#help').remove() }); $('.donot_tip').on('click', function () { $('#help').remove() }) } }, } })();