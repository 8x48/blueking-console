BLUEKING.appmanage=function(){return{init:function(){$("#appmanage .amg_close").off("click").on("click",function(){BLUEKING.appmanage.close()}),$("#amg_folder_container").on("contextmenu",".appbtn",function(){return!1}),BLUEKING.appmanage.move(),BLUEKING.appmanage.moveScrollbar()},set:function(){$("#desktop").hide(),$("#appmanage").show(),$("#amg_folder_container .folderItem").show().addClass("folderItem_turn"),$("#amg_folder_container .folderInner").height($(window).height()-80),$("#amg_dock_container").html("").append($("#dock-container .dock-applist li").clone());for(var j=0;j<5;j++){var desk_append="",desk=eval("BLUEKING.VAR.desk"+(j+1));""!=desk&&$(desk).each(function(e){desk_append+=appbtnTemp({title:this.name,name:this.name,type:this.type,id:"d_"+this.appid,appid:this.appid,code:this.app_code,imgsrc:this.icon,isoutline:this.isoutline,islapp:this.islapp})}),$("#amg_folder_container .folderItem:eq("+j+") .folderInner").html(desk_append)}BLUEKING.appmanage.setPos(),BLUEKING.appmanage.getScrollbar()},setPos:function(){var e=BLUEKING.grid.getManageDockAppGrid(),o=BLUEKING.grid.getManageAppGrid();$("#amg_dock_container li").each(function(o){$(this).css({top:10,left:e[o].startX+6})});for(var t=0;t<5;t++)$("#amg_folder_container .folderItem:eq("+t+") .folderInner li").each(function(e){$(this).css({top:o[e].startY+5,left:0})})},move:function(){$("#amg_dock_container").on("mousedown","li",function(e){if(e.preventDefault(),e.stopPropagation(),0==e.button||1==e.button){var o=$(this),t=$('<li id="shortcut_shadow">'+o.html()+"</li>"),n=e.clientX,i=e.clientY,a=e.clientX,r=e.clientY,s=n-o.offset().left,p=i-o.offset().top,l=BLUEKING.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(t),l.show(),a=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX,r=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY,n==a&&i==r||t.css({left:a-s,top:r-p}).show()}).on("mouseup",function(){$(document).off("mousemove").off("mouseup"),t.remove(),l.hide(),n==a&&i==r&&(BLUEKING.appmanage.close(),$("#dock-container .dock-applist > li[id='"+o.attr("id")+"']").click())})}return!1}),$("#amg_folder_container").on("mousedown","li.appbtn:not(.add)",function(e){if(e.preventDefault(),e.stopPropagation(),0==e.button||1==e.button){var o=$(this),t=$('<li id="shortcut_shadow2">'+o.html()+"</li>"),n=e.clientX,i=e.clientY,a=e.clientX,r=e.clientY,s=n-o.offset().left,p=i-o.offset().top,l=BLUEKING.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(t),l.show(),a=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX,r=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY,n==a&&i==r||t.css({left:a-s,top:r-p}).show()}).on("mouseup",function(){if($(document).off("mousemove").off("mouseup"),t.remove(),l.hide(),n==a&&i==r){switch(BLUEKING.appmanage.close(),o.attr("type")){case"app":case"folder":BLUEKING.window.create(o.attr("appid"))}return!1}if(r>80){var e=parseInt(a/($(window).width()/5)),s=BLUEKING.grid.searchManageAppGrid(r-80+$("#amg_folder_container .folderItem:eq("+e+") .folderInner").scrollTop());if(e+1==o.parent().attr("desk")){if(null!=s&&s!=o.index()){var p=BLUEKING.grid.searchManageAppGrid2(r-80+$("#amg_folder_container .folderItem:eq("+e+") .folderInner").scrollTop()),c=o.attr("appid"),d=o.index(),f=s,h=p%2==0?"b":"a",m=e+1;if(!BLUEKING.app.checkIsMoving()&&BLUEKING.app.dataDeskToDesk(c,d,f,h,m)){var u=d<f?0:1,g=d<f?-1:0;f="a"==h?f+u:f+g,$.ajax({type:"POST",url:urlPrefix+"update_my_app/"+c+"/",data:"movetype=desk-desk&from="+d+"&to="+f+"&desk="+m,success:function(){BLUEKING.VAR.isAppMoving=!1}})}}}else if(null!=s){var p=BLUEKING.grid.searchManageAppGrid2(r-80+$("#amg_folder_container .folderItem:eq("+e+") .folderInner").scrollTop()),c=o.attr("appid"),d=o.index(),f=s,h=p%2==0?"b":"a",I=e+1,_=o.parent().attr("desk");BLUEKING.app.checkIsMoving()||BLUEKING.app.dataDeskToOtherdesk(c,d,f,h,I,_)&&(f="a"==h?f+1:f,$.ajax({type:"POST",url:urlPrefix+"update_my_app/"+c+"/",data:"movetype=desk-otherdesk&from="+d+"&to="+f+"&desk="+_+"&otherdesk="+I,success:function(){BLUEKING.VAR.isAppMoving=!1}}))}}})}return!1})},getScrollbar:function(){$("#amg_folder_container .folderInner").height($(window).height()-80),$("#amg_folder_container .folderItem").each(function(){var e=$(this).find(".folderInner"),o=parseInt(e.children(".appbtn:last").css("top"))+41,t=e.next(".scrollBar"),n=t.position().top;t.hide(),e.scrollTop(0),e.height()/o<1&&(t.height(e.height()/o*e.height()),n=n+t.height()>e.height()?e.height()-t.height():n,t.css("top",n).show(),e.scrollTop(n/e.height()*o))})},moveScrollbar:function(){$(".scrollBar").on("mousedown",function(e){var o,t,n,i,a=$(this),r=a.prev(".folderInner");n=parseInt(r.children(".appbtn:last").css("top"))+41,i=r.height()-a.height(),o=e.clientY-a.offset().top,$(document).on("mousemove",function(e){t=e.clientY-o-80<0?0:e.clientY-o-80>i?i:e.clientY-o-80,a.css("top",t),r.scrollTop(t/r.height()*n)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})}),$("#amg_folder_container .folderInner").on("mousewheel",function(e,o){var t,n=$(this),i=parseInt(n.children(".appbtn:last").css("top"))+41;t=o<0?n.scrollTop()+120>i-n.height()?i-n.height():n.scrollTop()+120:n.scrollTop()-120<0?0:n.scrollTop()-120,n.stop(!1,!0).animate({scrollTop:t},300),n.next(".scrollBar").stop(!1,!0).animate({top:t/i*n.height()},300)})},resize:function(){BLUEKING.appmanage.getScrollbar()},close:function(){$("#amg_dock_container").html(""),$("#amg_folder_container .folderInner").html(""),$("#desktop").show(),$("#appmanage").hide(),$("#amg_folder_container .folderItem").removeClass("folderItem_turn"),BLUEKING.app.set(),BLUEKING.deskTop.resize()}}}();