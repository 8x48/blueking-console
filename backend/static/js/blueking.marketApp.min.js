BLUEKING.marketApp=function(){return{init:function(){$('[rel="tooltip"]').tooltip(),$("[datatype]").focusin(function(){$(this).parent().addClass("info").children(".infomsg").show().siblings(".help-inline").hide()}).focusout(function(){$(this).parent().removeClass("info").children(".infomsg").hide().siblings(".help-inline").show()}),BLUEKING.marketApp.get_nearest_open_app_list(),$(".btn-add-s").live("click",function(){var t=$(this).attr("app_id");$(this).removeClass().addClass("btn-loading-s");try{window.parent.BLUEKING.app.add(t,function(t){$("#pagination ul li.active").each(function(){var t=parseInt($(this).text());t&&BLUEKING.marketApp.getPageList(t)}),"1"==t?window.parent.BLUEKING.app.get():"2"==t?ZENG.msgbox.show(gettext("您早就添加了该应用，请不要重复添加！"),5,2e3):ZENG.msgbox.show(gettext("添加失败！"),5,2e3)})}catch(t){}}),$(".btn-remove-s").live("click",function(){try{window.parent.BLUEKING.app.remove_new($(this).attr("app_id"),function(t){0==t?ZENG.msgbox.show(gettext("删除失败！"),5,2e3):(1==t?window.parent.BLUEKING.app.get():3==t&&ZENG.msgbox.show(gettext("您早就删除了该应用，请不要重复操作！"),1,2e3),$("#pagination ul li.active").each(function(){var t=parseInt($(this).text());t&&BLUEKING.marketApp.getPageList(t)}))})}catch(t){}}),$(".btn-run-s").live("click",function(){try{""==$(this).attr("app_id")?window.top.BLUEKING.api.open_app_by_other($(this).attr("app_code")):window.parent.BLUEKING.window.create($(this).attr("app_id"))}catch(t){}})},get_nearest_open_app_list:function(){$.ajax({type:"GET",data:{},url:urlPrefix+"market_get_nearest_open_app/",success:function(t){var e=t.app_list,a="";if(e.length>0)for(var i in e)a+=appopenTemp({name:e[i].name,code:e[i].code,realid:e[i].realid,logo_url:e[i].logo_url,islapp:e[i].islapp});else a='<div class="detail_tips">'+gettext("<p>最近一个月里</p><p>您还没有打开任何应用哦！</p>")+"</div>";$("#nearest_app").html(a)}})},getPageList:function(t,e){ZENG.msgbox.show(gettext("正在加载中，请稍后..."),6,1e5);var a=(t-1)*parseInt($("#pagination_setting").attr("per")),i=t*parseInt($("#pagination_setting").attr("per")),s=$.trim($("#keyword").val()),o={};switch(e){case 0:o={from:a,to:i,topbar_select:$("#topbar_select").val(),sidebar_select:$("#sidebar_select").val()};break;case 1:o={from:a,to:i,topbar_select:$("#topbar_select").val(),sidebar_select:$("#sidebar_select").val(),keyword:s};break;case 2:o={from:a,to:i,topbar_select:$("#topbar_select").val(),keyword:s};break;default:o={from:a,to:i,topbar_select:$("#topbar_select").val(),sidebar_select:$("#sidebar_select").val(),keyword:s}}$.ajax({type:"GET",url:urlPrefix+"market_get_list/",data:o,success:function(e){var a=parseInt($("#pagination_setting").attr("per")),i=e.total,s=e.app_info_list;if(i%a>0)var o=parseInt(i/a+1);else var o=parseInt(i/a);$("#pagination_setting").attr("count",o);var r="";for(var n in s)r+=apptrTemp({name:s[n].name,code:s[n].code,introduction:s[n].introduction,use_count:s[n].use_count,user_app_id:s[n].user_app_id,relapp_id:s[n].relapp_id,logo_url:s[n].logo_url,is_saas:s[n].is_saas,developer:s[n].developer,is_has:s[n].is_has,app_visit_count:s[n].app_visit_count,islapp:s[n].islapp});$(".app-list").html(r),""==$("#keyword").val()?$("#app_total").html(interpolate(gettext('共有 <strong id="app_total" class="color_red">%(total)s</strong> 个应用'),{total:i},!0)):$("#app_total").html(interpolate(gettext('共搜到 <strong id="app_total" class="color_red">%(total)s</strong> 个应用'),{total:i},!0)),0!=i?(BLUEKING.marketApp.initPagination(t),$("#pagination").show()):$("#pagination").hide(),ZENG.msgbox._hide()}})},initPagination:function(t){try{var e={currentPage:t,totalPages:parseInt($("#pagination_setting").attr("count")),numberOfPages:7,alignment:"center",onPageClicked:function(e,a,i,s){s!=t&&BLUEKING.marketApp.getPageList(s)},shouldShowPage:function(t,e,a){switch(t){case"first":case"last":return!1;default:return!0}},itemTexts:function(t,e,a){switch(t){case"prev":return gettext("上一页");case"next":return gettext("下一页");case"page":return e}},tooltipTitles:function(t,e,a){switch(t){case"first":return"Tooltip for first page";case"prev":return gettext("上一页");case"next":return gettext("下一页");case"last":return"Tooltip for last page";case"page":return interpolate(gettext("第%s页"),[e])}}};$("#pagination").bootstrapPaginator(e)}catch(t){}},get_all_app_on_background:function(){$(".all").addClass("app-all-on"),$(".app-list-box .title ul").show(),$("#sidebar_select").val("0"),$(".app-list-box .title li").removeClass("focus"),$(".app-list-box .title li[_value=1]").addClass("focus"),$("#topbar_select").val(1),BLUEKING.marketSearchbox.clearSearchInput(),BLUEKING.marketApp.getPageList(1,0)},openDetailIframe:function(t){var e=urlPrefix+"market_app_detail/"+t+"/";ZENG.msgbox.show(gettext("正在载入中，请稍后..."),6,1e5),$("#detailIframe iframe").attr("src",e).load(function(){$("#detailIframe").show(),ZENG.msgbox._hide()})},closeDetailIframe:function(t){$("#detailIframe").hide(),t&&t()}}}();