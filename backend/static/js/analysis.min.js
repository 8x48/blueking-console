!function(e){e.extend(e.fn,{livequery:function(i,o,t){var r,n=this;return e.isFunction(i)&&(t=o,o=i,i=void 0),e.each(e.livequery.queries,function(e,s){if(!(n.selector!=s.selector||n.context!=s.context||i!=s.type||o&&o.$lqguid!=s.fn.$lqguid||t&&t.$lqguid!=s.fn2.$lqguid))return(r=s)&&!1}),r=r||new e.livequery(this.selector,this.context,i,o,t),r.stopped=!1,r.run(),this},expire:function(i,o,t){var r=this;return e.isFunction(i)&&(t=o,o=i,i=void 0),e.each(e.livequery.queries,function(n,s){r.selector!=s.selector||r.context!=s.context||i&&i!=s.type||o&&o.$lqguid!=s.fn.$lqguid||t&&t.$lqguid!=s.fn2.$lqguid||this.stopped||e.livequery.stop(s.id)}),this}}),e.livequery=function(i,o,t,r,n){return this.selector=i,this.context=o,this.type=t,this.fn=r,this.fn2=n,this.elements=[],this.stopped=!1,this.id=e.livequery.queries.push(this)-1,r.$lqguid=r.$lqguid||e.livequery.guid++,n&&(n.$lqguid=n.$lqguid||e.livequery.guid++),this},e.livequery.prototype={stop:function(){var e=this;this.type?this.elements.unbind(this.type,this.fn):this.fn2&&this.elements.each(function(i,o){e.fn2.apply(o)}),this.elements=[],this.stopped=!0},run:function(){if(!this.stopped){var i=this,o=this.elements,t=e(this.selector,this.context),r=t.not(o);this.elements=t,this.type?(r.bind(this.type,this.fn),o.length>0&&e.each(o,function(o,r){e.inArray(r,t)<0&&e.event.remove(r,i.type,i.fn)})):(r.each(function(){i.fn.apply(this)}),this.fn2&&o.length>0&&e.each(o,function(o,r){e.inArray(r,t)<0&&i.fn2.apply(r)}))}}},e.extend(e.livequery,{guid:0,queries:[],queue:[],running:!1,timeout:null,checkQueue:function(){if(e.livequery.running&&e.livequery.queue.length)for(var i=e.livequery.queue.length;i--;)e.livequery.queries[e.livequery.queue.shift()].run()},pause:function(){e.livequery.running=!1},play:function(){e.livequery.running=!0,e.livequery.run()},registerPlugin:function(){e.each(arguments,function(i,o){if(e.fn[o]){var t=e.fn[o];e.fn[o]=function(){var i=t.apply(this,arguments);return e.livequery.run(),i}}})},run:function(i){void 0!=i?e.inArray(i,e.livequery.queue)<0&&e.livequery.queue.push(i):e.each(e.livequery.queries,function(i){e.inArray(i,e.livequery.queue)<0&&e.livequery.queue.push(i)}),e.livequery.timeout&&clearTimeout(e.livequery.timeout),e.livequery.timeout=setTimeout(e.livequery.checkQueue,20)},stop:function(i){void 0!=i?e.livequery.queries[i].stop():e.each(e.livequery.queries,function(i){e.livequery.queries[i].stop()})}}),e.livequery.registerPlugin("append","prepend","after","before","wrap","attr","removeAttr","addClass","removeClass","toggleClass","empty","remove","html"),e(function(){e.livequery.play()})}(jQuery),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function i(e){return c.raw?e:encodeURIComponent(e)}function o(e){return c.raw?e:decodeURIComponent(e)}function t(e){return i(c.json?JSON.stringify(e):String(e))}function r(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(s," ")),c.json?JSON.parse(e):e}catch(e){}}function n(i,o){var t=c.raw?i:r(i);return e.isFunction(o)?o(t):t}var s=/\+/g,c=e.cookie=function(r,s,u){if(arguments.length>1&&!e.isFunction(s)){if(u=e.extend({},c.defaults,u),"number"==typeof u.expires){var a=u.expires,p=u.expires=new Date;p.setTime(+p+864e5*a)}return document.cookie=[i(r),"=",t(s),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join("")}for(var l=r?void 0:{},f=document.cookie?document.cookie.split("; "):[],_=0,d=f.length;d>_;_++){var S=f[_].split("="),h=o(S.shift()),$=S.join("=");if(r&&r===h){l=n($,s);break}r||void 0===($=n($))||(l[h]=$)}return l};c.defaults={},e.removeCookie=function(i,o){return void 0!==e.cookie(i)&&(e.cookie(i,"",e.extend({},o,{expires:-1})),!e.cookie(i))}});var BKANALYSIS={api_urlprefix:"",app_code:"",user_online_time:12e3,submit_time:6e5,init:function(){var e=window.location.href,i=e.split("/");i.length>=5&&"o"==i[3]?BKANALYSIS.app_code=i[4]:BKANALYSIS.app_code="workbench";var o=window.location.host,t=window.location.protocol;BKANALYSIS.api_urlprefix=t+"//"+o+"/console/analysis/"},app_record_data_submit:function(){if($.cookie("r_f")&&$.cookie("r_s")){var e=$.parseJSON($.cookie("r_f")),i=$.parseJSON($.cookie("r_s"));if(BKANALYSIS.is_empty(e.msg)||BKANALYSIS.is_empty(i.msg))try{BKANALYSIS.save_app_click_record()}catch(e){}}},app_online_time_submit:function(){if($.cookie("o_f")&&$.cookie("o_s")){var e=$.parseJSON($.cookie("o_f")),i=$.parseJSON($.cookie("o_s"));if(BKANALYSIS.is_empty(e.msg)||BKANALYSIS.is_empty(i.msg))try{BKANALYSIS.save_app_online_record()}catch(e){}}},date_to_string:function(e){return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},is_empty:function(e){for(var i in e)return!0;return!1},app_click_record:function(e){var i=BKANALYSIS.app_code;if(""==i)return!1;var o=$.cookie("r_f"),t=$.cookie("r_s");if(null==o||null==t){var r={lock:!0,msg:{}},n={lock:!1,msg:{}};$.cookie("r_f",$.toJSON(r),{expires:7,path:"/"}),$.cookie("r_s",$.toJSON(n),{expires:7,path:"/"}),o=$.cookie("r_f"),t=$.cookie("r_s")}if(o&&t){var s=$.parseJSON($.cookie("r_f")),c=$.parseJSON($.cookie("r_s"));s.lock?(s.msg[i]?s.msg[i]+=e:s.msg[i]=e,$.cookie("r_f",$.toJSON(s),{expires:7,path:"/"})):c.lock&&(c.msg[i]?c.msg[i]+=e:c.msg[i]=e,$.cookie("r_s",$.toJSON(c),{expires:7,path:"/"}))}return!0},save_app_click_record:function(){var e=$.cookie("r_f"),i=$.cookie("r_s");if(e&&i){var o=$.parseJSON($.cookie("r_f")),t=$.parseJSON($.cookie("r_s"));o.lock?(o.lock=!1,$.cookie("r_f",$.toJSON(o),{expires:7,path:"/"}),t.lock=!0,$.cookie("r_s",$.toJSON(t),{expires:7,path:"/"}),$.ajax({type:"GET",url:BKANALYSIS.api_urlprefix+"app_liveness_save/",data:{app_msg:$.toJSON(o.msg)},success:function(e){e.result&&(o.msg={},$.cookie("r_f",$.toJSON(o),{expires:7,path:"/"}))},dataType:"jsonp",async:!1})):t.lock&&(t.lock=!1,$.cookie("r_s",$.toJSON(t),{expires:7,path:"/"}),o.lock=!0,$.cookie("r_f",$.toJSON(o),{expires:7,path:"/"}),$.ajax({type:"GET",url:BKANALYSIS.api_urlprefix+"app_liveness_save/",data:{app_msg:$.toJSON(t.msg)},success:function(e){e.result&&(t.msg={},$.cookie("r_s",$.toJSON(t),{expires:7,path:"/"}))},dataType:"jsonp",async:!1}))}},app_online_record:function(e){var i=BKANALYSIS.app_code;if(""==i)return!1;var o=BKANALYSIS.date_to_string(new Date),t=$.cookie("o_f"),r=$.cookie("o_s");if(null==t||null==r){var n={lock:!0,msg:{}},s={lock:!1,msg:{}};$.cookie("o_f",$.toJSON(n),{expires:7,path:"/"}),$.cookie("o_s",$.toJSON(s),{expires:7,path:"/"}),t=$.cookie("o_f"),r=$.cookie("o_s")}if(t&&r){var c=$.parseJSON(t),u=$.parseJSON(r);c.lock?(c.msg[i]?c.msg[i][o]?c.msg[i][o]+=e:c.msg[i][o]=e:(c.msg[i]={},c.msg[i][o]=e),$.cookie("o_f",$.toJSON(c),{expires:7,path:"/"})):u.lock&&(u.msg[i]?u.msg[i][o]?u.msg[i][o]+=e:u.msg[i][o]=e:(u.msg[i]={},u.msg[i][o]=e),$.cookie("o_s",$.toJSON(u),{expires:7,path:"/"}))}return!0},save_app_online_record:function(){var e=$.cookie("o_f"),i=$.cookie("o_s");if(e&&i){var o=$.parseJSON(e),t=$.parseJSON(i);o.lock?(o.lock=!1,$.cookie("o_f",$.toJSON(o),{expires:7,path:"/"}),t.lock=!0,$.cookie("o_s",$.toJSON(t),{expires:7,path:"/"}),$.ajax({type:"GET",url:BKANALYSIS.api_urlprefix+"app_online_time_save/",data:{app_msg:$.toJSON(o.msg)},success:function(e){e.result&&(o.msg={},$.cookie("o_f",$.toJSON(o),{expires:7,path:"/"}))},dataType:"jsonp",async:!1})):t.lock&&(t.lock=!1,$.cookie("o_s",$.toJSON(t),{expires:7,path:"/"}),o.lock=!0,$.cookie("o_f",$.toJSON(o),{expires:7,path:"/"}),$.ajax({type:"GET",url:BKANALYSIS.api_urlprefix+"app_online_time_save/",data:{app_msg:$.toJSON(t.msg)},success:function(e){e.result&&(t.msg={},$.cookie("o_s",$.toJSON(t),{expires:7,path:"/"}))},dataType:"jsonp",async:!1}))}},app_record_by_user:function(){if(""==BKANALYSIS.app_code)return!1;$.ajax({url:BKANALYSIS.api_urlprefix+"app_record_by_user/"+BKANALYSIS.app_code+"/",type:"GET",dataType:"jsonp",data:{}})}};$(document).ready(function(){function e(){if(t=new Date,n=t,t-s>o){if(s-r>0)try{BKANALYSIS.app_online_record(s-r)}catch(e){}}else if(n-r>0)try{BKANALYSIS.app_online_record(n-r)}catch(e){}r=t,n=t,s=t}BKANALYSIS.init(),window.onload=function(){"workbench"!=BKANALYSIS.app_code&&window.setInterval(BKANALYSIS.app_record_data_submit,BKANALYSIS.submit_time),window.setInterval(BKANALYSIS.app_online_time_submit,BKANALYSIS.submit_time)};var i=window.location.pathname;if(void 0===window.top.BLUEKING&&"workbench"!=BKANALYSIS.app_code&&(i=="/o/"+BKANALYSIS.app_code||i=="/o/"+BKANALYSIS.app_code+"/"))try{BKANALYSIS.app_record_by_user()}catch(e){}$("a, button, input:button, input:submit, .btn").livequery("click",function(){try{BKANALYSIS.app_click_record(1)}catch(e){}});try{var o=parseInt(BKANALYSIS.user_online_time)?parseInt(BKANALYSIS.user_online_time):12e3}catch(e){var o=12e3}var t=new Date,r=t,n=t,s=t;window.onfocus=function(){t=new Date,r=t;var e=r-n;if(e<=o&&e>0)try{BKANALYSIS.app_online_record(e)}catch(e){}n=t,s=t},window.onblur=function(){e()},window.onunload=function(){e()},window.onclick=function(){if((t=new Date)-s>o){if(s-r>0)try{BKANALYSIS.app_online_record(s-r)}catch(e){}r=t,n=t}s=t}});